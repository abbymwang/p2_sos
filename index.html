<!-- Single HTML file for all code,-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SENSE OF SELF</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,700;1,400&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --red: #ff0000;
    --red-dark: #cc0000;
    --gray-panel: #d9d9d9;
    --radius: 28px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #ffffff;
    color: var(--red);
    font-family: 'IBM Plex Serif', serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    padding: 20px 32px;
    flex-shrink: 0;
    position: relative;
  }

  .info-btn {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: var(--red);
    color: #fff;
    border: none;
    font-family: 'IBM Plex Serif', serif;
    font-size: 1rem;
    font-style: italic;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    z-index: 1;
  }

  .header-title {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Roboto', sans-serif;
    font-size: 0.9rem;
    font-weight: 450;
    letter-spacing: 0.12em;
    color: var(--red);
    text-transform: uppercase;
    white-space: nowrap;
  }

  .header-right {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 16px;
    font-family: 'Roboto', sans-serif;
    font-size: 0.75rem;
    color: var(--red);
    z-index: 1;
  }

  .status-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: #ccc;
    display: inline-block;
    margin-right: 5px;
  }
  .status-dot.live { background: var(--red); animation: pulse 1.2s infinite; }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* MAIN LAYOUT */
  main {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1.1fr;
    padding: 12px 32px 24px;
    overflow: hidden;
  }

  /* LEFT: CAMERA */
  #camera-panel {
    display: flex;
    flex-direction: column;
    padding-right: 24px;
  }

  .camera-wrapper {
    position: relative;
    flex: 1;
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--gray-panel);
  }

  #video {
    width: 100%; height: 100%;
    object-fit: cover;
    transform: scaleX(-1);
    display: block;
  }

  #face-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    transform: scaleX(-1);
    pointer-events: none;
  }

  .camera-overlay-text {
    position: absolute;
    bottom: 14px; left: 14px;
    font-size: 0.6rem;
    color: rgba(0,0,0,0.4);
    letter-spacing: 1px;
    font-family: 'Roboto', sans-serif;
  }

  #no-camera-msg {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 14px;
    color: rgba(0,0,0,0.35);
    font-size: 0.8rem;
    font-family: 'Roboto', sans-serif;
  }

  .camera-icon { font-size: 2.5rem; opacity: 0.4; }

  /* RIGHT: TYPING */
  #typing-panel {
    display: flex;
    flex-direction: column;
    padding-left: 8px;
    overflow: hidden;
    justify-content: space-between;
  }

  #passage-wrapper {
    flex: 1;
    overflow: hidden;
    padding: 4px 0;
    scrollbar-width: none;
  }
  #passage-wrapper::-webkit-scrollbar { display: none; }

  #passage {
    font-family: 'IBM Plex Serif', serif;
    font-size: clamp(1.3rem, 2.2vw, 1.85rem);
    line-height: 1.55;
    letter-spacing: 0.01em;
    word-break: break-word;
    color: var(--red);
    pointer-events: none;
    user-select: none;
  }

  #passage .char { display: inline; transition: color 0.12s; }
  #passage .char.correct  { color: rgba(255,0,0,0.35); }
  #passage .char.incorrect { color: #fff; background: var(--red); border-radius: 2px; }
  #passage .char.cursor {
    border-left: 2px solid var(--red);
    margin-left: -1px;
    animation: blink 0.9s step-end infinite;
  }

  @keyframes blink { 0%,100%{border-color:var(--red)} 50%{border-color:transparent} }

  #author-line {
    font-family: 'IBM Plex Serif', serif;
    font-size: 1.3rem;
    color: var(--red);
    margin-top: 10px;
    min-height: 1.4em;
  }

  #type-input {
    background: var(--red);
    border: none;
    border-radius: 999px;
    color: #fff;
    font-family: 'IBM Plex Serif', serif;
    font-size: 1rem;
    padding: 16px 24px;
    outline: none;
    resize: none;
    height: 56px;
    width: 100%;
    flex-shrink: 0;
    margin-top: 16px;
  }
  #type-input::placeholder { color: rgba(255,255,255,0.65); }
  #type-input:disabled     { opacity: 0.5; }

  .bottom-row {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-top: 12px;
    gap: 16px;
    flex-shrink: 0;
  }

  .another-sense-btn {
    font-family: 'IBM Plex Serif', serif;
    font-size: 0.9rem;
    color: var(--red);
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: underline;
    padding: 0;
  }

  .btn-small {
    font-family: 'Roboto', sans-serif;
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 7px 14px;
    border-radius: 6px;
    border: 1px solid rgba(255,0,0,0.3);
    background: transparent;
    color: var(--red);
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-small:hover { background: var(--red); color: #fff; }

  .stats-row, .panel-label, .hint { display: none; }

  /* RESULT OVERLAYS */
  .result-stats {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin-bottom: 36px;
  }
  .result-stat { display: flex; flex-direction: column; gap: 4px; align-items: center; }
  .result-stat-val { font-family: 'IBM Plex Serif', serif; font-size: 2.4rem; line-height: 1; color: var(--red); }
  .result-stat-lbl { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: rgba(255,0,0,0.45); font-family: 'Roboto', sans-serif; }

  @keyframes flashRed { 0%{background:rgba(255,0,0,0.08)} 100%{background:transparent} }
  .flash-red { animation: flashRed 0.4s ease; }

  @keyframes slideUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,0,0,0.3); border-radius: 2px; }

  #mistake-count-display { display: none; }
  .mistake-bar           { display: none; }
  #face-status           { font-size: 0.75rem; }
  #timer-display         { font-size: 0.75rem; font-family: 'Roboto', sans-serif; }
</style>
</head>
<body>

<header>
  <button class="info-btn" onclick="alert('Can you find your sense of self without getting lost? Start typing. (ëˆˆâ€¸ëˆˆ)')">i</button>
  <div class="header-title">DON'T LOSE YOURâ¸»SENSE OF SELF</div>
  <div class="header-right">
    <span><span class="status-dot live" id="cam-status-dot"></span><span id="cam-status-text">Camera Off</span></span> <!--Modifying-->
    <span id="timer-display">00:00</span>
    <span id="face-status">Face: â€“</span>
  </div>
</header>

<main>
  <!-- LEFT: Camera -->
  <div id="camera-panel">
    <div class="camera-wrapper">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="face-canvas"></canvas>
      <div class="camera-overlay-text" id="cam-overlay"></div>
      <div id="no-camera-msg">
        <div class="camera-icon">ðŸ“·</div>
        <div>(looking for a camera)</div>
        <button
          class="btn-small"
          style="margin-top:8px;border-radius:999px;background:var(--red);color:#fff;border:none;padding:10px 22px;"
          onclick="startCamera()"
        >Enable Camera</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: Typing test -->
  <div id="typing-panel">

    <!-- Hidden stats kept for JS compatibility -->
    <div class="stats-row" style="display:none;">
      <div class="stat-box"><div class="stat-label">WPM</div><div class="stat-value" id="wpm-val">â€“</div></div>
      <div class="stat-box"><div class="stat-label">Accuracy</div><div class="stat-value" id="acc-val">â€“</div></div>
      <div class="stat-box"><div class="stat-label">Errors</div><div class="stat-value" id="err-val">0</div></div>
      <div class="stat-box"><div class="stat-label">Progress</div><div class="stat-value" id="prog-val">0%</div></div>
    </div>
    <div style="display:none;" id="mistake-count-display">0</div>

    <div id="passage-wrapper">
      <div id="passage"></div>
    </div>

    <div id="author-line">
      <span id="author-text"></span>
    </div>

    <textarea
      id="type-input"
      placeholder="Type here to find the Self"
      spellcheck="false"
      autocomplete="off"
      autocorrect="off"
      autocapitalize="off"
    ></textarea>

    <div class="bottom-row">
      <button class="btn-small" onclick="resetTest()">Reset</button>
      <button class="btn-small" onclick="cyclePassage()">â†» New</button>
    </div>
  </div>
</main>

<!-- FAILURE OVERLAY -->
<div id="end-overlay" style="display:none;position:fixed;inset:0;z-index:200;align-items:center;justify-content:center;background:rgba(255,255,255,0.15);backdrop-filter:blur(2px);">
  <div style="background:#ff0000;border-radius:16px;width:min(680px,88vw);padding:56px 64px;position:relative;animation:slideUp 0.35s ease;">
    <button onclick="closeEnd()" style="position:absolute;top:20px;right:28px;background:none;border:none;color:#fff;font-size:1.1rem;cursor:pointer;font-family:'Roboto',sans-serif;letter-spacing:1px;">X</button>
    <div id="end-message" style="font-family:'IBM Plex Serif',serif;font-size:1.55rem;line-height:1.55;color:#fff;"></div>
    <div style="margin-top:36px;display:flex;gap:12px;">
      <button onclick="resetTest();closeEnd();" style="background:none;border:1.5px solid rgba(255,255,255,0.6);border-radius:999px;color:#fff;font-family:'Roboto',sans-serif;font-size:0.75rem;letter-spacing:1px;text-transform:uppercase;padding:10px 24px;cursor:pointer;">Try Again</button>
      <button onclick="cyclePassage();closeEnd();" style="background:none;border:1.5px solid rgba(255,255,255,0.6);border-radius:999px;color:#fff;font-family:'Roboto',sans-serif;font-size:0.75rem;letter-spacing:1px;text-transform:uppercase;padding:10px 24px;cursor:pointer;">Another Sense</button>
    </div>
  </div>
</div>

<!-- SUCCESS OVERLAY -->
<div id="success-overlay" style="display:none;position:fixed;inset:0;z-index:200;align-items:center;justify-content:center;background:rgba(255,255,255,0.6);backdrop-filter:blur(8px);">
  <div style="text-align:center;animation:slideUp 0.4s ease;padding:48px;">
    <div style="font-family:'IBM Plex Serif',serif;font-size:clamp(1.6rem,3.5vw,2.6rem);color:#ff0000;line-height:1.4;max-width:560px;margin:0 auto 40px;">
      You've found yourself.<br>Will you continue searching?
    </div>
    <div style="display:flex;gap:16px;justify-content:center;">
      <button onclick="cyclePassage();closeEnd();" style="background:#ff0000;border:none;border-radius:999px;color:#fff;font-family:'Roboto',sans-serif;font-size:0.8rem;letter-spacing:1px;text-transform:uppercase;padding:14px 32px;cursor:pointer;">Continue</button>
      <button onclick="closeEnd();" style="background:none;border:1.5px solid #ff0000;border-radius:999px;color:#ff0000;font-family:'Roboto',sans-serif;font-size:0.8rem;letter-spacing:1px;text-transform:uppercase;padding:14px 32px;cursor:pointer;">Rest Here</button>
    </div>
  </div>
</div>

<!-- Hidden legacy result elements kept for JS compatibility -->
<div id="result-overlay" style="display:none;">
  <div>
    <div id="result-title"></div>
    <div id="result-sub"></div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-val" id="r-wpm">â€“</div><div class="result-stat-lbl">WPM</div></div>
      <div class="result-stat"><div class="result-stat-val" id="r-acc">â€“</div><div class="result-stat-lbl">Accuracy</div></div>
      <div class="result-stat"><div class="result-stat-val" id="r-err">â€“</div><div class="result-stat-lbl">Mistakes</div></div>
    </div>
  </div>
</div>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>

<!-- App -->
<script src="mapping.js"></script>

</body>
</html>